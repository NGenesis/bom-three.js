THREE.BOMLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BOMLoader.prototype={constructor:THREE.BOMLoader,load:function(e,t,r,E){var n=this,o=THREE.FileLoader?new THREE.FileLoader(this.manager):new THREE.XHRLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},r,E)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},setDebug:function(e){this.debug=e},setPerfTimer:function(e){this.performanceTimer=e},setResponseType:function(e){this.responseType=e},parse:function(e){function t(){var e=c.getUint8(f);return f+=Uint8Array.BYTES_PER_ELEMENT,e}function r(){var e=c.getUint16(f,!0);return f+=Uint16Array.BYTES_PER_ELEMENT,e}function E(){var e=c.getUint32(f,!0);return f+=Uint32Array.BYTES_PER_ELEMENT,e}function n(){var e=c.getFloat32(f,!0);return f+=Float32Array.BYTES_PER_ELEMENT,e}function o(e){var t=String.fromCharCode.apply(null,e>0?new Uint8Array(c.buffer,f,e):new Uint8Array);return f+=Uint8Array.BYTES_PER_ELEMENT*e,t}function a(e){if(0===f%Uint16Array.BYTES_PER_ELEMENT){var t=new Uint16Array(c.buffer,f,e);return f+=Uint16Array.BYTES_PER_ELEMENT*e,t}for(var t=new Uint16Array(e),r=0;e>r;++r,f+=Uint16Array.BYTES_PER_ELEMENT)t[r]=c.getUint16(f,!0);return t}function i(e){if(0===f%Float32Array.BYTES_PER_ELEMENT){var t=new Float32Array(c.buffer,f,e);return f+=Float32Array.BYTES_PER_ELEMENT*e,t}for(var t=new Float32Array(e),r=0;e>r;++r,f+=Float32Array.BYTES_PER_ELEMENT)t[r]=c.getFloat32(f,!0);return t}function s(e){return"string"!=typeof e||""===e?"":/^https?:\/\//i.test(e)?e:(d.texturePath||d.path||"")+e}function T(e){e=s(e);var t;if(altspace&&altspace.inClient)t=new THREE.Texture({src:e});else{var r=THREE.Loader.Handlers.get(e);null===r&&(r=new THREE.TextureLoader(d.manager)),r.setCrossOrigin(d.crossOrigin),t=r.load(e)}return t.side=THREE.FrontSide,t.wrapS=t.wrapT=THREE.RepeatWrapping,t}this.performanceTimer&&console.time("BOMLoader");var l={NONE:0,FRONT:1,BACK:2,ALL:3},A={NONE:1,MATERIAL_LIBRARY:2},u={NONE:1,NAME:2,INDEX:4,SMOOTHING:8,MATERIAL:16},M={NONE:1,NAME:2,GEOMETRY:4},L={NONE:1,NORMAL:2,UV:4},R={NONE:1,ILLUMINATION_MODEL:2,SPECULAR_EXPONENT:4,OPTICAL_DENSITY:8,DISSOLVE:16,TRANSMISSION_FILTER:32,AMBIENT_REFLECTANCE:64,DIFFUSE_REFLECTANCE:128,SPECULAR_REFLECTANCE:256,EMISSIVE_REFLECTANCE:512,AMBIENT_MAP:1024,DIFFUSE_MAP:2048,SPECULAR_MAP:4096,EMISSIVE_MAP:8192,DISSOLVE_MAP:16384,BUMP_MAP:32768,DISPLACEMENT_MAP:65536,FACE_CULLING:1<<17},S={NONE:1,PATH:2,SCALE:4,OFFSET:8,BUMP_SCALE:16,DISPLACEMENT_SCALE:32},c=new DataView(e),f=0,p="array"===this.responseType,N=p?[]:new THREE.Group,d=this,g=o(3);this.debug&&console.log("File Signature",g);var I=t();this.debug&&console.log("Version",I);var P=r();this.debug&&console.log("FileAttributes:","\n","Material Library",B&A.MATERIAL_LIBRARY?!0:!1);var _=[];if(P&A.MATERIAL_LIBRARY){var C=r();this.debug&&console.log("Material Count",C);for(var O=0;C>O;++O){var h=E();this.debug&&console.log("MaterialAttributes:","\n","Illumination Model",h&R.ILLUMINATION_MODEL?!0:!1,"\n","Specular Exponent",h&R.SPECULAR_EXPONENT?!0:!1,"\n","Optical Density",h&R.OPTICAL_DENSITY?!0:!1,"\n","Dissolve",h&R.DISSOLVE?!0:!1,"\n","Transmission Filter",h&R.TRANSMISSION_FILTER?!0:!1,"\n","Ambient Reflectance",h&R.AMBIENT_REFLECTANCE?!0:!1,"\n","Diffuse Reflectance",h&R.DIFFUSE_REFLECTANCE?!0:!1,"\n","Specular Reflectance",h&R.SPECULAR_REFLECTANCE?!0:!1,"\n","Ambient Map",h&R.AMBIENT_MAP?!0:!1,"\n","Diffuse Map",h&R.DIFFUSE_MAP?!0:!1,"\n","Specular Map",h&R.SPECULAR_MAP?!0:!1,"\n","Dissolve Map",h&R.DISSOLVE_MAP?!0:!1,"\n","Bump Map",h&R.BUMP_MAP?!0:!1,"\n","Displacement Map",h&R.DISPLACEMENT_MAP?!0:!1,"\n","Face Culling",h&R.FACE_CULLING?!0:!1);var v={};if(v.name=o(r()),this.debug&&console.log("Material Name",v.name),h&R.ILLUMINATION_MODEL&&t(),h&R.SPECULAR_EXPONENT&&(v.shininess=n(),this.debug&&console.log("Specular Exponent",v.shininess)),h&R.OPTICAL_DENSITY&&n(),h&R.DISSOLVE&&(v.opacity=n(),v.transparent=!0,this.debug&&console.log("Dissolve",v.opacity)),h&R.TRANSMISSION_FILTER&&(n(),n(),n()),h&R.AMBIENT_REFLECTANCE&&(n(),n(),n()),h&R.DIFFUSE_REFLECTANCE&&(v.color=new THREE.Color(n(),n(),n()),this.debug&&console.log("Diffuse Reflectance",v.color)),h&R.SPECULAR_REFLECTANCE&&(v.specular=new THREE.Color(n(),n(),n()),this.debug&&console.log("Specular Reflectance",v.specular)),h&R.EMISSIVE_REFLECTANCE&&(v.emissive=new THREE.Color(n(),n(),n()),this.debug&&console.log("Emissive Reflectance",v.emissive)),h&R.AMBIENT_MAP){var F=r();F&S.PATH&&o(r()),F&S.SCALE&&(n(),n()),F&S.OFFSET&&(n(),n())}if(h&R.DIFFUSE_MAP){var F=r(),b=T(F&S.PATH?o(r()):"");F&S.SCALE&&b.repeat.set(n(),n()),F&S.OFFSET&&b.offset.set(n(),n()),v.map=b,this.debug&&F&S.PATH&&console.log("Diffuse Map",b)}if(h&R.SPECULAR_MAP){var F=r(),b=T(F&S.PATH?o(r()):"");F&S.SCALE&&b.repeat.set(n(),n()),F&S.OFFSET&&b.offset.set(n(),n()),v.specularMap=b}if(h&R.EMISSIVE_MAP){var F=r(),b=T(F&S.PATH?o(r()):"");F&S.SCALE&&b.repeat.set(n(),n()),F&S.OFFSET&&b.offset.set(n(),n()),v.emissiveMap=b}if(h&R.DISSOLVE_MAP){var F=r(),b=T(F&S.PATH?o(r()):"");F&S.SCALE&&b.repeat.set(n(),n()),F&S.OFFSET&&b.offset.set(n(),n()),v.alphaMap=b,v.transparent=!0}if(h&R.BUMP_MAP){var F=r(),b=T(F&S.PATH?o(r()):"");F&S.SCALE&&b.repeat.set(n(),n()),F&S.OFFSET&&b.offset.set(n(),n()),F&S.BUMP_SCALE&&(v.bumpScale=n()),v.bumpMap=b}if(h&R.DISPLACEMENT_MAP){var F=r(),b=T(F&S.PATH?o(r()):"");F&S.SCALE&&b.repeat.set(n(),n()),F&S.OFFSET&&b.offset.set(n(),n()),F&S.DISPLACEMENT_SCALE&&(v.displacementScale=n()),v.displacementMap=b}if(h&R.FACE_CULLING){var m=t();m===l.ALL?v.visible=!1:v.side=m===l.FRONT?THREE.BackSide:m===l.BACK?THREE.FrontSide:THREE.DoubleSide}var H=new THREE.MeshPhongMaterial(v);_.push(H)}}var U=r();this.debug&&console.log("Object Count",U);for(var O=0;U>O;++O){var B=r();this.debug&&console.log("ObjectAttributes:","\n","Name",B&M.NAME?!0:!1,"\n","Geometry",B&M.GEOMETRY?!0:!1);var D=new THREE.Group,y=E();if(p?(y>=N.length&&N.push(new THREE.Group),N[y].add(D)):(y>=N.children.length&&N.add(new THREE.Group),N.children[y].add(D)),B&M.NAME){var w=o(r());this.debug&&console.log("Object Name",w),D.name=w}var G={};if(B&M.GEOMETRY){var Y=r();this.debug&&console.log("GeometryAttributes:","\n","Normal",Y&L.NORMAL?!0:!1,"\n","UV",Y&L.UV?!0:!1);var V=E();this.debug&&console.log("Vertex Count",V),G.positions=i(3*V),Y&L.NORMAL&&(G.normals=i(3*V)),Y&L.UV&&(G.uvs=i(2*V))}var x=r();this.debug&&console.log("Group Count",x);for(var X=0;x>X;++X){var j=r();this.debug&&console.log("GroupAttributes:","\n","Index",j&u.INDEX?!0:!1,"\n","Smoothing",j&u.SMOOTHING?!0:!1,"\n","Material",j&u.MATERIAL?!0:!1);var K;j&u.NAME&&(K=o(r()),this.debug&&console.log("Group Name",K));var k;if(B&M.GEOMETRY){var W;if(j&u.INDEX){var q=E();this.debug&&console.log("Index Count",q),W=a(q)}var z=j&u.SMOOTHING?t():0;this.debug&&j&u.SMOOTHING&&console.log("Smoothing",z);var J=new THREE.BufferGeometry;G.positions&&J.addAttribute("position",new THREE.BufferAttribute(G.positions,3)),G.normals?J.addAttribute("normal",new THREE.BufferAttribute(G.normals,3)):J.computeVertexNormals(),G.uvs&&J.addAttribute("uv",new THREE.BufferAttribute(G.uvs,2)),W&&J.setIndex(new THREE.BufferAttribute(W,1)),J.addGroup(0,1,0);var H;if(j&u.MATERIAL){var Q=r();H=_[Q].clone()||new THREE.MeshPhongMaterial,H.shading=z>0?THREE.SmoothShading:THREE.FlatShading,this.debug&&console.log("Group Material",Q,H)}k=new THREE.Mesh(J,H)}void 0===k&&(k=new THREE.Group),K&&(k.name=K),D.add(k)}}return this.performanceTimer&&console.timeEnd("BOMLoader"),N}},THREE.BOMLoaderUtil=THREE.BOMLoaderUtil||{},THREE.BOMLoaderUtil.multiload=function(e,t){function r(e,r){var o=new THREE.BOMLoader;o.setTexturePath(r.url.split("/").slice(0,-1).join("/")+"/"),void 0!==r.debug&&o.setDebug(r.debug),void 0!==r.timer&&o.setPerfTimer(r.timer),void 0!==r.crossOrigin&&o.setCrossOrigin(r.crossOrigin),void 0!==r.responseType&&o.setResponseType(r.responseType),o.load(r.url,function(o){r.object=o,n[e]=r,0>=--E&&t(n)})}e=e.constructor===Array?e:[e];for(var E=e.length,n=[],o=0;e.length>o;++o)r(o,e[o])};