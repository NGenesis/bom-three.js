THREE.BOMLoader=function(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager},THREE.BOMLoader.prototype={constructor:THREE.BOMLoader,load:function(t,e,a,r){var E=this,n=THREE.FileLoader?new THREE.FileLoader(this.manager):new THREE.XHRLoader(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.load(t,function(t){e(E.parse(t))},a,r)},setPath:function(t){this.path=t},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},setDebug:function(t){this.debug=t},setResponseType:function(t){this.responseType=t},parse:function(t){function e(){var t=S.getUint8(R);return R+=Uint8Array.BYTES_PER_ELEMENT,t}function a(){var t=S.getUint16(R,!0);return R+=Uint16Array.BYTES_PER_ELEMENT,t}function r(){var t=S.getUint32(R,!0);return R+=Uint32Array.BYTES_PER_ELEMENT,t}function E(){var t=S.getFloat32(R,!0);return R+=Float32Array.BYTES_PER_ELEMENT,t}function n(t){var e=String.fromCharCode.apply(null,t>0?new Uint8Array(S.buffer,R,t):new Uint8Array);return R+=Uint8Array.BYTES_PER_ELEMENT*t,e}function o(t){if(0===R%Uint16Array.BYTES_PER_ELEMENT){var e=new Uint16Array(S.buffer,R,t);return R+=Uint16Array.BYTES_PER_ELEMENT*t,e}for(var e=new Uint16Array(t),a=0;t>a;++a,R+=Uint16Array.BYTES_PER_ELEMENT)e[a]=S.getUint16(R,!0);return e}function i(t){if(0===R%Float32Array.BYTES_PER_ELEMENT){var e=new Float32Array(S.buffer,R,t);return R+=Float32Array.BYTES_PER_ELEMENT*t,e}for(var e=new Float32Array(t),a=0;t>a;++a,R+=Float32Array.BYTES_PER_ELEMENT)e[a]=S.getFloat32(R,!0);return e}function s(t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:(f.texturePath||f.path||"")+t}function A(t){t=s(t);var e=THREE.Loader.Handlers.get(t);null===e&&(e=new THREE.TextureLoader(f.manager)),e.setCrossOrigin&&e.setCrossOrigin(f.crossOrigin);var a=e.load(t);return a.side=THREE.FrontSide,a.wrapS=a.wrapT=THREE.RepeatWrapping,a}console.time("BOMLoader");var u={NONE:1,MATERIAL_LIBRARY:2},M={NONE:1,NAME:2,INDEX:4,SMOOTHING:8,MATERIAL:16},T={NONE:1,NAME:2,GEOMETRY:4},l={NONE:1,NORMAL:2,UV:4},p={NONE:1,ILLUMINATION_MODEL:2,SPECULAR_EXPONENT:4,OPTICAL_DENSITY:8,DISSOLVE:16,TRANSMISSION_FILTER:32,AMBIENT_REFLECTANCE:64,DIFFUSE_REFLECTANCE:128,SPECULAR_REFLECTANCE:256,EMISSIVE_REFLECTANCE:512,AMBIENT_MAP:1024,DIFFUSE_MAP:2048,SPECULAR_MAP:4096,EMISSIVE_MAP:8192,DISSOLVE_MAP:16384,BUMP_MAP:32768,DISPLACEMENT_MAP:65536};MapDataAttribute={NONE:1,PATH:2,SCALE:4,OFFSET:8,BUMP_SCALE:16,DISPLACEMENT_SCALE:32};var S=new DataView(t),R=0,L="array"==this.responseType,N=L?[]:new THREE.Group,f=this,c=n(3);this.debug&&console.log("File Signature",c);var g=e();this.debug&&console.log("Version",g);var I=a();this.debug&&console.log("FileAttributes:","\n","Material Library",F&u.MATERIAL_LIBRARY?!0:!1);var b=[];if(I&u.MATERIAL_LIBRARY){var d=a();this.debug&&console.log("Material Count",d);for(var P=0;d>P;++P){var _=r();this.debug&&console.log("MaterialAttributes:","\n","Illumination Model",_&p.ILLUMINATION_MODEL?!0:!1,"\n","Specular Exponent",_&p.SPECULAR_EXPONENT?!0:!1,"\n","Optical Density",_&p.OPTICAL_DENSITY?!0:!1,"\n","Dissolve",_&p.DISSOLVE?!0:!1,"\n","Transmission Filter",_&p.TRANSMISSION_FILTER?!0:!1,"\n","Ambient Reflectance",_&p.AMBIENT_REFLECTANCE?!0:!1,"\n","Diffuse Reflectance",_&p.DIFFUSE_REFLECTANCE?!0:!1,"\n","Specular Reflectance",_&p.SPECULAR_REFLECTANCE?!0:!1,"\n","Ambient Map",_&p.AMBIENT_MAP?!0:!1,"\n","Diffuse Map",_&p.DIFFUSE_MAP?!0:!1,"\n","Specular Map",_&p.SPECULAR_MAP?!0:!1,"\n","Dissolve Map",_&p.DISSOLVE_MAP?!0:!1,"\n","Bump Map",_&p.BUMP_MAP?!0:!1,"\n","Displacement Map",_&p.DISPLACEMENT_MAP?!0:!1);var h={};if(h.name=n(a()),this.debug&&console.log("Material Name",h.name),_&p.ILLUMINATION_MODEL&&e(),_&p.SPECULAR_EXPONENT&&(h.shininess=E(),this.debug&&console.log("Specular Exponent",h.shininess)),_&p.OPTICAL_DENSITY&&E(),_&p.DISSOLVE&&(h.opacity=E(),h.transparent=!0,this.debug&&console.log("Dissolve",h.opacity)),_&p.TRANSMISSION_FILTER&&(E(),E(),E()),_&p.AMBIENT_REFLECTANCE&&(E(),E(),E()),_&p.DIFFUSE_REFLECTANCE&&(h.color=new THREE.Color(E(),E(),E()),this.debug&&console.log("Diffuse Reflectance",h.color)),_&p.SPECULAR_REFLECTANCE&&(h.specular=new THREE.Color(E(),E(),E()),this.debug&&console.log("Specular Reflectance",h.specular)),_&p.EMISSIVE_REFLECTANCE&&(h.emissive=new THREE.Color(E(),E(),E()),this.debug&&console.log("Emissive Reflectance",h.emissive)),_&p.AMBIENT_MAP){var C=a();C&MapDataAttribute.PATH&&n(a()),C&MapDataAttribute.SCALE&&(E(),E()),C&MapDataAttribute.OFFSET&&(E(),E())}if(_&p.DIFFUSE_MAP){var C=a(),O=A(C&MapDataAttribute.PATH?n(a()):"");C&MapDataAttribute.SCALE&&O.repeat.set(E(),E()),C&MapDataAttribute.OFFSET&&O.offset.set(E(),E()),h.map=O,this.debug&&C&MapDataAttribute.PATH&&console.log("Diffuse Map",O)}if(_&p.SPECULAR_MAP){var C=a(),O=A(C&MapDataAttribute.PATH?n(a()):"");C&MapDataAttribute.SCALE&&O.repeat.set(E(),E()),C&MapDataAttribute.OFFSET&&O.offset.set(E(),E()),h.specularMap=O}if(_&p.EMISSIVE_MAP){var C=a(),O=A(C&MapDataAttribute.PATH?n(a()):"");C&MapDataAttribute.SCALE&&O.repeat.set(E(),E()),C&MapDataAttribute.OFFSET&&O.offset.set(E(),E()),h.emissiveMap=O}if(_&p.DISSOLVE_MAP){var C=a(),O=A(C&MapDataAttribute.PATH?n(a()):"");C&MapDataAttribute.SCALE&&O.repeat.set(E(),E()),C&MapDataAttribute.OFFSET&&O.offset.set(E(),E()),h.alphaMap=O,h.transparent=!0}if(_&p.BUMP_MAP){var C=a(),O=A(C&MapDataAttribute.PATH?n(a()):"");C&MapDataAttribute.SCALE&&O.repeat.set(E(),E()),C&MapDataAttribute.OFFSET&&O.offset.set(E(),E()),C&MapDataAttribute.BUMP_SCALE&&(h.bumpScale=E()),h.bumpMap=O}if(_&p.DISPLACEMENT_MAP){var C=a(),O=A(C&MapDataAttribute.PATH?n(a()):"");C&MapDataAttribute.SCALE&&O.repeat.set(E(),E()),C&MapDataAttribute.OFFSET&&O.offset.set(E(),E()),C&MapDataAttribute.DISPLACEMENT_SCALE&&(h.displacementScale=E()),h.displacementMap=O}var D=new THREE.MeshPhongMaterial(h);b.push(D)}}var v=a();this.debug&&console.log("Object Count",v);for(var P=0;v>P;++P){var F=a();this.debug&&console.log("ObjectAttributes:","\n","Name",F&T.NAME?!0:!1,"\n","Geometry",F&T.GEOMETRY?!0:!1);var H=new THREE.Group,m=r();if(L?(m>=N.length&&N.push(new THREE.Group),N[m].add(H)):(m>=N.children.length&&N.add(new THREE.Group),N.children[m].add(H)),F&T.NAME){var U=n(a());this.debug&&console.log("Object Name",U),H.name=U}var B={};if(F&T.GEOMETRY){var y=a();this.debug&&console.log("GeometryAttributes:","\n","Normal",y&l.NORMAL?!0:!1,"\n","UV",y&l.UV?!0:!1);var w=r();this.debug&&console.log("Vertex Count",w),B.positions=i(3*w),y&l.NORMAL&&(B.normals=i(3*w)),y&l.UV&&(B.uvs=i(2*w))}var G=a();this.debug&&console.log("Group Count",G);for(var Y=0;G>Y;++Y){var V=a();this.debug&&console.log("GroupAttributes:","\n","Index",V&M.INDEX?!0:!1,"\n","Smoothing",V&M.SMOOTHING?!0:!1,"\n","Material",V&M.MATERIAL?!0:!1);var x;V&M.NAME&&(x=n(a()),this.debug&&console.log("Group Name",x));var X;if(F&T.GEOMETRY){var j;if(V&M.INDEX){var W=r();this.debug&&console.log("Index Count",W),j=o(W)}var k=V&M.SMOOTHING?e():0;this.debug&&V&M.SMOOTHING&&console.log("Smoothing",k);var q=new THREE.BufferGeometry;B.positions&&q.addAttribute("position",new THREE.BufferAttribute(B.positions,3)),B.normals?q.addAttribute("normal",new THREE.BufferAttribute(B.normals,3)):q.computeVertexNormals(),B.uvs&&q.addAttribute("uv",new THREE.BufferAttribute(B.uvs,2)),j&&q.setIndex(new THREE.BufferAttribute(j,1)),q.addGroup(0,1,0);var D;if(V&M.MATERIAL){var z=a();D=b[z].clone()||new THREE.MeshPhongMaterial,D.shading=k>0?THREE.SmoothShading:THREE.FlatShading,this.debug&&console.log("Group Material",z,D)}X=new THREE.Mesh(q,D)}void 0===X&&(X=new THREE.Group),x&&(X.name=x),H.add(X)}}return console.timeEnd("BOMLoader"),N}};