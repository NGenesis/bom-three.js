THREE.BOMLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BOMLoader.prototype={constructor:THREE.BOMLoader,load:function(e,t,r,E){var n=this,o=THREE.FileLoader?new THREE.FileLoader(this.manager):new THREE.XHRLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},r,E)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},setDebug:function(e){this.debug=e},setPerfTimer:function(e){this.performanceTimer=e},setResponseType:function(e){this.responseType=e},parse:function(e){function t(){var e=c.getUint8(N);return N+=Uint8Array.BYTES_PER_ELEMENT,e}function r(){var e=c.getUint16(N,!0);return N+=Uint16Array.BYTES_PER_ELEMENT,e}function E(){var e=c.getUint32(N,!0);return N+=Uint32Array.BYTES_PER_ELEMENT,e}function n(){var e=c.getFloat32(N,!0);return N+=Float32Array.BYTES_PER_ELEMENT,e}function o(e){var t=String.fromCharCode.apply(null,e>0?new Uint8Array(c.buffer,N,e):new Uint8Array);return N+=Uint8Array.BYTES_PER_ELEMENT*e,t}function a(e){if(0===N%Uint16Array.BYTES_PER_ELEMENT){var t=new Uint16Array(c.buffer,N,e);return N+=Uint16Array.BYTES_PER_ELEMENT*e,t}for(var t=new Uint16Array(e),r=0;e>r;++r,N+=Uint16Array.BYTES_PER_ELEMENT)t[r]=c.getUint16(N,!0);return t}function i(e){if(0===N%Float32Array.BYTES_PER_ELEMENT){var t=new Float32Array(c.buffer,N,e);return N+=Float32Array.BYTES_PER_ELEMENT*e,t}for(var t=new Float32Array(e),r=0;e>r;++r,N+=Float32Array.BYTES_PER_ELEMENT)t[r]=c.getFloat32(N,!0);return t}function s(e){if("string"!=typeof e||""===e)return"";if(/^https?:\/\//i.test(e))return e;var t=new URL((I.texturePath||I.path||"")+e,location.href.substring(0,location.href.lastIndexOf("/")+1));return""+t}function T(e){e=s(e);var t;if(altspace&&altspace.inClient)t=new THREE.Texture({src:e});else{var r=THREE.Loader.Handlers.get(e);null===r&&(r=new THREE.TextureLoader(I.manager)),r.setCrossOrigin(I.crossOrigin),t=r.load(e)}return t.side=THREE.FrontSide,t.wrapS=t.wrapT=THREE.RepeatWrapping,t}this.performanceTimer&&console.time("BOMLoader");var A={NONE:0,FRONT:1,BACK:2,ALL:3},u={NONE:1,MATERIAL_LIBRARY:2},l={NONE:1,NAME:2},M={NONE:1,NAME:2,INDEX:4,SMOOTHING:8,MATERIAL:16},L={NONE:1,GEOMETRY:2},S={NONE:1,NORMAL:2,UV1:4,UV2:8},f={NONE:1,ILLUMINATION_MODEL:2,SPECULAR_EXPONENT:4,OPTICAL_DENSITY:8,DISSOLVE:16,TRANSMISSION_FILTER:32,AMBIENT_REFLECTANCE:64,DIFFUSE_REFLECTANCE:128,SPECULAR_REFLECTANCE:256,EMISSIVE_REFLECTANCE:512,AMBIENT_MAP:1024,DIFFUSE_MAP:2048,SPECULAR_MAP:4096,EMISSIVE_MAP:8192,DISSOLVE_MAP:16384,BUMP_MAP:32768,DISPLACEMENT_MAP:65536,FACE_CULLING:1<<17,LIGHT_MAP:1<<18},R={NONE:1,PATH:2,SCALE:4,OFFSET:8,BUMP_SCALE:16,DISPLACEMENT_SCALE:32,LIGHTMAP_INTENSITY:64},c=new DataView(e),N=0,p="array"===this.responseType,g=p?[]:new THREE.Group,I=this,d=o(3);this.debug&&console.log("File Signature",d);var P=t();this.debug&&console.log("Version",P);var _=r();this.debug&&console.log("FileAttributes:","\n","Material Library",V&u.MATERIAL_LIBRARY?!0:!1);var v=[];if(_&u.MATERIAL_LIBRARY){var C=r();this.debug&&console.log("Material Count",C);for(var O=0;C>O;++O){var h=E();this.debug&&console.log("MaterialAttributes:","\n","Illumination Model",h&f.ILLUMINATION_MODEL?!0:!1,"\n","Specular Exponent",h&f.SPECULAR_EXPONENT?!0:!1,"\n","Optical Density",h&f.OPTICAL_DENSITY?!0:!1,"\n","Dissolve",h&f.DISSOLVE?!0:!1,"\n","Transmission Filter",h&f.TRANSMISSION_FILTER?!0:!1,"\n","Ambient Reflectance",h&f.AMBIENT_REFLECTANCE?!0:!1,"\n","Diffuse Reflectance",h&f.DIFFUSE_REFLECTANCE?!0:!1,"\n","Specular Reflectance",h&f.SPECULAR_REFLECTANCE?!0:!1,"\n","Ambient Map",h&f.AMBIENT_MAP?!0:!1,"\n","Diffuse Map",h&f.DIFFUSE_MAP?!0:!1,"\n","Specular Map",h&f.SPECULAR_MAP?!0:!1,"\n","Dissolve Map",h&f.DISSOLVE_MAP?!0:!1,"\n","Bump Map",h&f.BUMP_MAP?!0:!1,"\n","Displacement Map",h&f.DISPLACEMENT_MAP?!0:!1,"\n","Face Culling",h&f.FACE_CULLING?!0:!1,"\n","Light Map",h&f.LIGHT_MAP?!0:!1);var F={};if(F.name=o(r()),this.debug&&console.log("Material Name",F.name),h&f.ILLUMINATION_MODEL&&t(),h&f.SPECULAR_EXPONENT&&(F.shininess=n(),this.debug&&console.log("Specular Exponent",F.shininess)),h&f.OPTICAL_DENSITY&&n(),h&f.DISSOLVE&&(F.opacity=n(),F.transparent=!0,this.debug&&console.log("Dissolve",F.opacity)),h&f.TRANSMISSION_FILTER&&(n(),n(),n()),h&f.AMBIENT_REFLECTANCE&&(n(),n(),n()),h&f.DIFFUSE_REFLECTANCE&&(F.color=new THREE.Color(n(),n(),n()),this.debug&&console.log("Diffuse Reflectance",F.color)),h&f.SPECULAR_REFLECTANCE&&(F.specular=new THREE.Color(n(),n(),n()),this.debug&&console.log("Specular Reflectance",F.specular)),h&f.EMISSIVE_REFLECTANCE&&(F.emissive=new THREE.Color(n(),n(),n()),this.debug&&console.log("Emissive Reflectance",F.emissive)),h&f.AMBIENT_MAP){var b=r();b&R.PATH&&o(r()),b&R.SCALE&&(n(),n()),b&R.OFFSET&&(n(),n())}if(h&f.DIFFUSE_MAP){var b=r(),H=T(b&R.PATH?o(r()):"");b&R.SCALE&&H.repeat.set(n(),n()),b&R.OFFSET&&H.offset.set(n(),n()),F.map=H,this.debug&&b&R.PATH&&console.log("Diffuse Map",H)}if(h&f.SPECULAR_MAP){var b=r(),H=T(b&R.PATH?o(r()):"");b&R.SCALE&&H.repeat.set(n(),n()),b&R.OFFSET&&H.offset.set(n(),n()),F.specularMap=H}if(h&f.EMISSIVE_MAP){var b=r(),H=T(b&R.PATH?o(r()):"");b&R.SCALE&&H.repeat.set(n(),n()),b&R.OFFSET&&H.offset.set(n(),n()),F.emissiveMap=H}if(h&f.DISSOLVE_MAP){var b=r(),H=T(b&R.PATH?o(r()):"");b&R.SCALE&&H.repeat.set(n(),n()),b&R.OFFSET&&H.offset.set(n(),n()),F.alphaMap=H,F.transparent=!0}if(h&f.BUMP_MAP){var b=r(),H=T(b&R.PATH?o(r()):"");b&R.SCALE&&H.repeat.set(n(),n()),b&R.OFFSET&&H.offset.set(n(),n()),b&R.BUMP_SCALE&&(F.bumpScale=n()),F.bumpMap=H}if(h&f.DISPLACEMENT_MAP){var b=r(),H=T(b&R.PATH?o(r()):"");b&R.SCALE&&H.repeat.set(n(),n()),b&R.OFFSET&&H.offset.set(n(),n()),b&R.DISPLACEMENT_SCALE&&(F.displacementScale=n()),F.displacementMap=H}if(h&f.FACE_CULLING){var m=t();m===A.ALL?F.visible=!1:F.side=m===A.FRONT?THREE.BackSide:m===A.BACK?THREE.FrontSide:THREE.DoubleSide}if(h&f.LIGHT_MAP){var b=r(),H=T(b&R.PATH?o(r()):"");b&R.SCALE&&H.repeat.set(n(),n()),b&R.OFFSET&&H.offset.set(n(),n()),b&R.LIGHTMAP_INTENSITY&&(F.lightMapIntensity=n()),F.lightMap=H}var U=new THREE.MeshPhongMaterial(F);v.push(U)}}var B=r();this.debug&&console.log("Asset Count",B);for(var D=0;B>D;++D){var y=r();this.debug&&console.log("AssetAttributes:","\n","Name",y&l.NAME?!0:!1);var w=g;if(p&&(w=new THREE.Group,g.push(w)),y&l.NAME){var G=o(r());this.debug&&console.log("Asset Name",G),p||(w.name=G)}var Y=r();this.debug&&console.log("Object Count",Y);for(var O=0;Y>O;++O){var V=r();this.debug&&console.log("ObjectAttributes:","\n","Geometry",V&L.GEOMETRY?!0:!1);var x={};if(V&L.GEOMETRY){var X=r();this.debug&&console.log("GeometryAttributes:","\n","Normal",X&S.NORMAL?!0:!1,"\n","UV1",X&S.UV1?!0:!1,"\n","UV2",X&S.UV2?!0:!1);var j=E();this.debug&&console.log("Vertex Count",j),x.positions=i(3*j),X&S.NORMAL&&(x.normals=i(3*j)),X&S.UV1&&(x.uvs=i(2*j)),X&S.UV2&&(x.uvs2=i(2*j))}var K=r();this.debug&&console.log("Group Count",K);for(var k=0;K>k;++k){var W=r();this.debug&&console.log("GroupAttributes:","\n","Index",W&M.INDEX?!0:!1,"\n","Smoothing",W&M.SMOOTHING?!0:!1,"\n","Material",W&M.MATERIAL?!0:!1);var q;if(W&M.NAME&&(q=o(r()),this.debug&&console.log("Group Name",q)),V&L.GEOMETRY){var z;if(W&M.INDEX){var J=E();this.debug&&console.log("Index Count",J),z=a(J)}var Q=W&M.SMOOTHING?t():0;this.debug&&W&M.SMOOTHING&&console.log("Smoothing",Q);var Z=new THREE.BufferGeometry;x.positions&&Z.addAttribute("position",new THREE.BufferAttribute(x.positions,3)),x.normals?Z.addAttribute("normal",new THREE.BufferAttribute(x.normals,3)):Z.computeVertexNormals(),x.uvs&&Z.addAttribute("uv",new THREE.BufferAttribute(x.uvs,2)),x.uvs2&&Z.addAttribute("uv2",new THREE.BufferAttribute(x.uvs2,2)),z&&Z.setIndex(new THREE.BufferAttribute(z,1)),Z.addGroup(0,1,0);var U;if(W&M.MATERIAL){var $=r();U=v[$].clone()||new THREE.MeshPhongMaterial,U.shading=Q>0?THREE.SmoothShading:THREE.FlatShading,this.debug&&console.log("Group Material",$,U)}var et=new THREE.Mesh(Z,U);q&&(et.name=q),w.add(et)}}}}return this.performanceTimer&&console.timeEnd("BOMLoader"),g}},THREE.BOMLoaderUtil=THREE.BOMLoaderUtil||{},THREE.BOMLoaderUtil.multiload=function(e,t){function r(e,r){var o=new THREE.BOMLoader;o.setTexturePath(r.url.split("/").slice(0,-1).join("/")+"/"),void 0!==r.debug&&o.setDebug(r.debug),void 0!==r.timer&&o.setPerfTimer(r.timer),void 0!==r.crossOrigin&&o.setCrossOrigin(r.crossOrigin),void 0!==r.responseType&&o.setResponseType(r.responseType),o.load(r.url,function(o){r.object=o,n[e]=r,0>=--E&&t(n)})}e=e.constructor===Array?e:[e];for(var E=e.length,n=[],o=0;e.length>o;++o)r(o,e[o])};