THREE.BOMLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BOMLoader.prototype={constructor:THREE.BOMLoader,load:function(e,t,r,E){var n=this,o=THREE.FileLoader?new THREE.FileLoader(this.manager):new THREE.XHRLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},r,E)},setPath:function(e){this.path=e},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},setDebug:function(e){this.debug=e},setPerfTimer:function(e){this.performanceTimer=e},setResponseType:function(e){this.responseType=e},parse:function(e){function t(){var e=f.getUint8(N);return N+=Uint8Array.BYTES_PER_ELEMENT,e}function r(){var e=f.getUint16(N,!0);return N+=Uint16Array.BYTES_PER_ELEMENT,e}function E(){var e=f.getUint32(N,!0);return N+=Uint32Array.BYTES_PER_ELEMENT,e}function n(){var e=f.getFloat32(N,!0);return N+=Float32Array.BYTES_PER_ELEMENT,e}function o(e){var t=String.fromCharCode.apply(null,e>0?new Uint8Array(f.buffer,N,e):new Uint8Array);return N+=Uint8Array.BYTES_PER_ELEMENT*e,t}function a(e){if(0===N%Uint16Array.BYTES_PER_ELEMENT){var t=new Uint16Array(f.buffer,N,e);return N+=Uint16Array.BYTES_PER_ELEMENT*e,t}for(var t=new Uint16Array(e),r=0;e>r;++r,N+=Uint16Array.BYTES_PER_ELEMENT)t[r]=f.getUint16(N,!0);return t}function i(e){if(0===N%Float32Array.BYTES_PER_ELEMENT){var t=new Float32Array(f.buffer,N,e);return N+=Float32Array.BYTES_PER_ELEMENT*e,t}for(var t=new Float32Array(e),r=0;e>r;++r,N+=Float32Array.BYTES_PER_ELEMENT)t[r]=f.getFloat32(N,!0);return t}function s(e){if("string"!=typeof e||""===e)return"";if(/^https?:\/\//i.test(e))return e;var t=new URL((d.texturePath||d.path||"")+e,location.href.substring(0,location.href.lastIndexOf("/")+1));return""+t}function A(e){e=s(e);var t;if(altspace&&altspace.inClient)t=new THREE.Texture({src:e});else{var r=THREE.Loader.Handlers.get(e);null===r&&(r=new THREE.TextureLoader(d.manager)),r.setCrossOrigin(d.crossOrigin),t=r.load(e)}return t.side=THREE.FrontSide,t.wrapS=t.wrapT=THREE.RepeatWrapping,t}this.performanceTimer&&console.time("BOMLoader");var T={NONE:0,FRONT:1,BACK:2,ALL:3},l={NONE:1,MATERIAL_LIBRARY:2},u={NONE:1,NAME:2},M={NONE:1,NAME:2,INDEX:4,SMOOTHING:8,MATERIAL:16},L={NONE:1,GEOMETRY:2},S={NONE:1,NORMAL:2,UV:4},R={NONE:1,ILLUMINATION_MODEL:2,SPECULAR_EXPONENT:4,OPTICAL_DENSITY:8,DISSOLVE:16,TRANSMISSION_FILTER:32,AMBIENT_REFLECTANCE:64,DIFFUSE_REFLECTANCE:128,SPECULAR_REFLECTANCE:256,EMISSIVE_REFLECTANCE:512,AMBIENT_MAP:1024,DIFFUSE_MAP:2048,SPECULAR_MAP:4096,EMISSIVE_MAP:8192,DISSOLVE_MAP:16384,BUMP_MAP:32768,DISPLACEMENT_MAP:65536,FACE_CULLING:1<<17},c={NONE:1,PATH:2,SCALE:4,OFFSET:8,BUMP_SCALE:16,DISPLACEMENT_SCALE:32},f=new DataView(e),N=0,p="array"===this.responseType,g=p?[]:new THREE.Group,d=this,I=o(3);this.debug&&console.log("File Signature",I);var C=t();this.debug&&console.log("Version",C);var P=r();this.debug&&console.log("FileAttributes:","\n","Material Library",V&l.MATERIAL_LIBRARY?!0:!1);var _=[];if(P&l.MATERIAL_LIBRARY){var O=r();this.debug&&console.log("Material Count",O);for(var h=0;O>h;++h){var v=E();this.debug&&console.log("MaterialAttributes:","\n","Illumination Model",v&R.ILLUMINATION_MODEL?!0:!1,"\n","Specular Exponent",v&R.SPECULAR_EXPONENT?!0:!1,"\n","Optical Density",v&R.OPTICAL_DENSITY?!0:!1,"\n","Dissolve",v&R.DISSOLVE?!0:!1,"\n","Transmission Filter",v&R.TRANSMISSION_FILTER?!0:!1,"\n","Ambient Reflectance",v&R.AMBIENT_REFLECTANCE?!0:!1,"\n","Diffuse Reflectance",v&R.DIFFUSE_REFLECTANCE?!0:!1,"\n","Specular Reflectance",v&R.SPECULAR_REFLECTANCE?!0:!1,"\n","Ambient Map",v&R.AMBIENT_MAP?!0:!1,"\n","Diffuse Map",v&R.DIFFUSE_MAP?!0:!1,"\n","Specular Map",v&R.SPECULAR_MAP?!0:!1,"\n","Dissolve Map",v&R.DISSOLVE_MAP?!0:!1,"\n","Bump Map",v&R.BUMP_MAP?!0:!1,"\n","Displacement Map",v&R.DISPLACEMENT_MAP?!0:!1,"\n","Face Culling",v&R.FACE_CULLING?!0:!1);var F={};if(F.name=o(r()),this.debug&&console.log("Material Name",F.name),v&R.ILLUMINATION_MODEL&&t(),v&R.SPECULAR_EXPONENT&&(F.shininess=n(),this.debug&&console.log("Specular Exponent",F.shininess)),v&R.OPTICAL_DENSITY&&n(),v&R.DISSOLVE&&(F.opacity=n(),F.transparent=!0,this.debug&&console.log("Dissolve",F.opacity)),v&R.TRANSMISSION_FILTER&&(n(),n(),n()),v&R.AMBIENT_REFLECTANCE&&(n(),n(),n()),v&R.DIFFUSE_REFLECTANCE&&(F.color=new THREE.Color(n(),n(),n()),this.debug&&console.log("Diffuse Reflectance",F.color)),v&R.SPECULAR_REFLECTANCE&&(F.specular=new THREE.Color(n(),n(),n()),this.debug&&console.log("Specular Reflectance",F.specular)),v&R.EMISSIVE_REFLECTANCE&&(F.emissive=new THREE.Color(n(),n(),n()),this.debug&&console.log("Emissive Reflectance",F.emissive)),v&R.AMBIENT_MAP){var b=r();b&c.PATH&&o(r()),b&c.SCALE&&(n(),n()),b&c.OFFSET&&(n(),n())}if(v&R.DIFFUSE_MAP){var b=r(),m=A(b&c.PATH?o(r()):"");b&c.SCALE&&m.repeat.set(n(),n()),b&c.OFFSET&&m.offset.set(n(),n()),F.map=m,this.debug&&b&c.PATH&&console.log("Diffuse Map",m)}if(v&R.SPECULAR_MAP){var b=r(),m=A(b&c.PATH?o(r()):"");b&c.SCALE&&m.repeat.set(n(),n()),b&c.OFFSET&&m.offset.set(n(),n()),F.specularMap=m}if(v&R.EMISSIVE_MAP){var b=r(),m=A(b&c.PATH?o(r()):"");b&c.SCALE&&m.repeat.set(n(),n()),b&c.OFFSET&&m.offset.set(n(),n()),F.emissiveMap=m}if(v&R.DISSOLVE_MAP){var b=r(),m=A(b&c.PATH?o(r()):"");b&c.SCALE&&m.repeat.set(n(),n()),b&c.OFFSET&&m.offset.set(n(),n()),F.alphaMap=m,F.transparent=!0}if(v&R.BUMP_MAP){var b=r(),m=A(b&c.PATH?o(r()):"");b&c.SCALE&&m.repeat.set(n(),n()),b&c.OFFSET&&m.offset.set(n(),n()),b&c.BUMP_SCALE&&(F.bumpScale=n()),F.bumpMap=m}if(v&R.DISPLACEMENT_MAP){var b=r(),m=A(b&c.PATH?o(r()):"");b&c.SCALE&&m.repeat.set(n(),n()),b&c.OFFSET&&m.offset.set(n(),n()),b&c.DISPLACEMENT_SCALE&&(F.displacementScale=n()),F.displacementMap=m}if(v&R.FACE_CULLING){var H=t();H===T.ALL?F.visible=!1:F.side=H===T.FRONT?THREE.BackSide:H===T.BACK?THREE.FrontSide:THREE.DoubleSide}var U=new THREE.MeshPhongMaterial(F);_.push(U)}}var B=r();this.debug&&console.log("Asset Count",B);for(var D=0;B>D;++D){var y=r();this.debug&&console.log("AssetAttributes:","\n","Name",y&u.NAME?!0:!1);var w=g;if(p&&(w=new THREE.Group,g.push(w)),y&u.NAME){var G=o(r());this.debug&&console.log("Asset Name",G),p||(w.name=G)}var Y=r();this.debug&&console.log("Object Count",Y);for(var h=0;Y>h;++h){var V=r();this.debug&&console.log("ObjectAttributes:","\n","Geometry",V&L.GEOMETRY?!0:!1);var x={};if(V&L.GEOMETRY){var X=r();this.debug&&console.log("GeometryAttributes:","\n","Normal",X&S.NORMAL?!0:!1,"\n","UV",X&S.UV?!0:!1);var j=E();this.debug&&console.log("Vertex Count",j),x.positions=i(3*j),X&S.NORMAL&&(x.normals=i(3*j)),X&S.UV&&(x.uvs=i(2*j))}var K=r();this.debug&&console.log("Group Count",K);for(var k=0;K>k;++k){var W=r();this.debug&&console.log("GroupAttributes:","\n","Index",W&M.INDEX?!0:!1,"\n","Smoothing",W&M.SMOOTHING?!0:!1,"\n","Material",W&M.MATERIAL?!0:!1);var q;if(W&M.NAME&&(q=o(r()),this.debug&&console.log("Group Name",q)),V&L.GEOMETRY){var z;if(W&M.INDEX){var J=E();this.debug&&console.log("Index Count",J),z=a(J)}var Q=W&M.SMOOTHING?t():0;this.debug&&W&M.SMOOTHING&&console.log("Smoothing",Q);var Z=new THREE.BufferGeometry;x.positions&&Z.addAttribute("position",new THREE.BufferAttribute(x.positions,3)),x.normals?Z.addAttribute("normal",new THREE.BufferAttribute(x.normals,3)):Z.computeVertexNormals(),x.uvs&&Z.addAttribute("uv",new THREE.BufferAttribute(x.uvs,2)),z&&Z.setIndex(new THREE.BufferAttribute(z,1)),Z.addGroup(0,1,0);var U;if(W&M.MATERIAL){var $=r();U=_[$].clone()||new THREE.MeshPhongMaterial,U.shading=Q>0?THREE.SmoothShading:THREE.FlatShading,this.debug&&console.log("Group Material",$,U)}var et=new THREE.Mesh(Z,U);q&&(et.name=q),w.add(et)}}}}return this.performanceTimer&&console.timeEnd("BOMLoader"),g}},THREE.BOMLoaderUtil=THREE.BOMLoaderUtil||{},THREE.BOMLoaderUtil.multiload=function(e,t){function r(e,r){var o=new THREE.BOMLoader;o.setTexturePath(r.url.split("/").slice(0,-1).join("/")+"/"),void 0!==r.debug&&o.setDebug(r.debug),void 0!==r.timer&&o.setPerfTimer(r.timer),void 0!==r.crossOrigin&&o.setCrossOrigin(r.crossOrigin),void 0!==r.responseType&&o.setResponseType(r.responseType),o.load(r.url,function(o){r.object=o,n[e]=r,0>=--E&&t(n)})}e=e.constructor===Array?e:[e];for(var E=e.length,n=[],o=0;e.length>o;++o)r(o,e[o])};